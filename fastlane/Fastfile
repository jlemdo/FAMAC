 lane :beta do
-  match(type: "appstore")
+  match(type: "appstore")

   cocoapods

   build_app(
     workspace: "ios/MyNewApp.xcworkspace",
     scheme:    "MyNewApp",
     export_method: "app-store",
     clean:      true
   )

-  # Volver a crear api_key aquí (podrías duplicar)
-  api_key = app_store_connect_api_key(
-    key_id:     ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"],
-    issuer_id:  ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
-    key_content: ENV["APP_STORE_CONNECT_API_KEY_CONTENT"].gsub("\\n","\n")
-  )
-  upload_to_testflight(api_key: api_key)
+  # Reusar la misma API Key que usó match
+  api_key = lane_context[SharedValues::APP_STORE_CONNECT_API_KEY]
+  upload_to_testflight(api_key: api_key)
 end
