name: üêû iOS Quick Debug

# Se ejecuta solo manualmente
on:
  workflow_dispatch:

jobs:
  quick-debug:
    name: Quick Debug en Simulador iOS
    runs-on: macos-latest

    steps:
      - name: Checkout de c√≥digo
        uses: actions/checkout@v3

      - name: Setup Ruby & CocoaPods
        run: |
          sudo gem install bundler cocoapods
          bundle config set path vendor/bundle
          bundle install

      - name: Instala dependencias JS
        run: yarn install --frozen-lockfile

      - name: Pod install (iOS)
        working-directory: ios
        run: pod install --repo-update

      - name: Build & Run en Simulador
        run: |
          # Aseg√∫rate que ning√∫n sim est√© corriendo
          xcrun simctl shutdown all || true

          # Bootea un simulador limpio (iPhone 14 / iOS 18.2)
          xcrun simctl boot "iPhone 14"

          # Compila en modo Debug (m√°s r√°pido)
          xcodebuild \
            -workspace ios/MyNewApp.xcworkspace \
            -scheme MyNewApp \
            -configuration Debug \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 14,OS=18.2' \
            build \
            | tee build.log

          # Instala y lanza la app
          APP_PATH=$(find ~/Library/Developer/Xcode/DerivedData -name MyNewApp.app | head -n1)
          xcrun simctl install booted "$APP_PATH"
          xcrun simctl launch booted com.occr.productos || true

          # Vuelca logs/crashes durante 60 s
          xcrun simctl spawn booted log stream --style compact --predicate 'eventType == logEvent' --timeout 60
